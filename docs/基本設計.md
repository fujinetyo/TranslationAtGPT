# 基本設計書

## 1. システム概要
Windows (x64) C#/.NET で開発する常駐アプリ。
ユーザーが選択したウィンドウのスクリーンショットを取得し、
OpenAI GPT-4o mini Vision API で OCR＋翻訳して表示する。

---

## 2. 画面仕様（UI）
### 2.1 ウィンドウ構成
- タイトルバー：閉じる（×）・最小化（−）
- 最大化ボタン：無効
- ウィンドウサイズ：可変
- 基本は1画面構成

### 2.2 UI要素
| UI要素 | 種別 | 内容 |
|------|------|------|
| ウィンドウ選択コンボボックス | ComboBox | キャプチャ対象のウィンドウを選択 |
| 更新ボタン | Button | ウィンドウ一覧を更新 |
| キャプチャ実行ボタン | Button | 選択ウィンドウを撮影 → API実行 |
| 追加プロンプト入力欄 | TextBox | 最大200文字 |
| サムネイル表示欄 | PictureBox | キャプチャした画像のサムネイルを表示 |
| 実行結果表示欄 | TextBox（READONLY） | OCR＋翻訳結果を表示、コピペ可 |
| ログ表示領域 | TextBox（READONLY） | 最新5行を表示 |

---

## 3. API仕様
- 使用モデル：**GPT-4o mini Vision**
- 入力：スクリーンショット（png）
- 出力：画像内テキスト + 日本語翻訳
- エラー時はログ表示

---

## 4. 設定（iniファイルで外部管理）
`settings.ini`（同一フォルダに配置）

| 項目 | 内容 | 必須 |
|---|---|---|
| api_key | OpenAI API Key | 必須 |
| default_prompt | デフォルトプロンプト | 任意 |

- アプリ起動時に読み込み
- 存在しない場合はエラー表示

---

## 5. スクリーンショット仕様
- 選択したウィンドウハンドルから取得
- 画像形式：PNG
- サイズが2000px以上の場合は自動縮小処理
- キャプチャ画像は `captures` ディレクトリに自動保存

---

## 6. ログ仕様
- 内部保持：最新5件のみ
- 表示：最新5件
- タイムスタンプ付きで表示
- 出力例：
  - `[12:34:56] ウィンドウ一覧取得を開始...`
  - `[12:34:57] 取得完了: 15個のウィンドウを検出`

---

## 7. 実装クラス構成
- `MainForm.cs` … UI とイベント処理
- `WindowCaptureService.cs` … スクリーンショット取得処理
- `WindowInfo.cs` … ウィンドウ情報を保持
- `OpenAIService.cs` … API通信処理
- `Settings.cs` … ini読込管理
- `Program.cs` … アプリケーションエントリポイント

---

## 8. 実装済み機能
- ✅ ウィンドウ一覧の取得と選択
- ✅ スクリーンショット撮影
- ✅ 画像の自動縮小処理
- ✅ サムネイル表示
- ✅ OpenAI API連携（OCR＋翻訳）
- ✅ settings.iniからの設定読み込み
- ✅ ログ表示機能
- ✅ キャプチャ画像の自動保存

---

## 9. 将来の拡張性
- モデル選択機能（GPT-4o等）
- 自動定期キャプチャ機能
- ホットキー登録機能
- 履歴保存機能
